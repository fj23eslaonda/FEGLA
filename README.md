# **FEGLA: Forward Energy Grade Line Analysis for Tsunami Inundation Mapping**

## **Overview**
FEGLA (Forward Energy Grade Line Analysis) is a computational model designed for tsunami inundation mapping based on the principles of energy conservation. It extends the Energy Grade Line Analysis (EGLA) methodology, enabling efficient estimation of maximum inundation distances with reduced computational costs while maintaining accuracy.

FEGLA is validated against thousands of tsunami simulations and provides a useful alternative for hazard assessments, emergency planning, and infrastructure resilience studies.

---

## **Contents**
The repository includes the following files and directories:

- `Data` – Contains input datasets, such as topobathymetric profiles and tsunami simulation results, necessary for running FEGLA.
- `Functions/` – Includes custom Python scripts that define specific functions used in preprocessing, model execution, and post-processing.
- `Processing/` - Scripts and utilities for processing raw data, applying transformations, and preparing inputs for the FEGLA algorithm.
- `Report/` - Contains documentation, figures, and possible research reports related to FEGLA's development and validation.
- `Results/` - Stores the output files generated by the model, including computed tsunami inundation maps, statistical analyses, and graphical representations.
- `Run/` - Executable scripts for running the FEGLA model.
- `README.md` – Documentation and instructions on how to install and run FEGLA.
- `LICENSE` – Licensing information for the project.
- `requirements.txt` – List of dependencies required to install and run FEGLA.

---


## **Cloning the Repository**
To get started, clone the repository to your local machine:

```bash
git clone https://github.com/fj23eslaonda/FEGLA.git
cd FEGLA
```

## **Setting Up the Environment**

To ensure a clean and isolated environment for running FEGLA, it is recommended to use a Python virtual environment.

### **1. Create a Virtual Environment**
Before installing dependencies, create a virtual environment using the following command:

```bash
python -m venv FEGLA
```
### **2. Activate the Virtual Environment**

- On macOS/linux
```bash
source FEGLA/bin/activate
```
- On Windows:
```bash
FEGLA\Scripts\activate
```

### **3. Install Required Dependencies**
Once the virtual environment is activated, install the required dependencies using:
```bash
pip install -r requirements.txt
```
---

## **Step-by-Step Application**

### **Step 1: data preprocessing**
Ensure the required datasets (bathymetric profiles, tsunami scenarios) are available in the Data/ directory.
  - The folder related to a specific city must be created inside Data folder.
  - To standardize the data format, netCDF format is used due to the nature of the data (lon, lat, h).
  - Topobathymetry data must have the following format and it must be named as: “Bathymetry.nc”.
  - Each simulation file must have the following format and its name must started with “hmax”.

More details can be found in `Step-by-Step FEGLA Application`.

### **Step 2: Create transects**
This step extracts transects for a specified city using the `get_transects.py` script.

```bash
# Activate the Python virtual enviroment
source FEGLA/bin/activate  # macOS/Linux
FEGLA\Scripts\activate     # Windows

# Change directory
cd Processing

# Run script
python get_transects.py --city "Arica" --extension_length 5000 --distance 100 --elevation_threshold 30
```
Parameter Definitions:

	•	--city → Name of the city folder (e.g., "Arica").
	•	--extension_length → Initial length of each transect in meters (e.g., 5000).
	•	--distance → Spacing between consecutive transects (typically 50m or 100m).
	•	--elevation_threshold → Maximum elevation used as a threshold for transects.

Once executed, a bathymetry plot is displayed. The user must click to define the shoreline, which finalizes the transect extraction process.

More details can be found in `Step-by-Step FEGLA Application`.

### **Step 3: Obtain flooded transects**
After generating the transect data, the next step is to **interpolate the transects** across all inundation maps derived from the Shallow Water Equations (SWE).

```bash
# Ensure you are in the Processing directory:
# Run the interpolation script
python get_hmax.py --city "Arica" --n_selected_sim 100
```
Parameter Definitions:

	•	--city → Name of the city folder (e.g., "Arica").
	•	--n_selected_sim → Number of selected simulations from the total available SWE simulations.

For a given location, thousands of SWE simulations (e.g., 3000) may be available. This script selects n_selected_sim simulations based on mean flooded heights at the shoreline, a key parameter for FEGLA. A weighted K-Means clustering method is applied to ensure the most representative simulations are selected for further analysis.

More details can be found in `Step-by-Step FEGLA Application`.

### **Step 4: Executing the Models**
To determine the best-fit model, three different parameterizations of the Froude number are tested: **Constant, Squared, and Linear**.

1. **Ensure all Python execution files are located in** `./FEGLA/Run/`.
2. **Prepare the JSON configuration file** (`params_inputs_city.json`), which contains the required inputs:

   Example: `params_inputs_Arica.json`
   ```json
   {
     "city": "Arica",
     "filepath": "../Data/Arica/Selected_Flooded_transects.h5",
     "outpath": "../Results",
     "batch_size": 12,
     "manning": 0.03,
     "F0": [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5],
     "FR": [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
   }

3. **Run the FEGLA model for different Forude number parameterizations**
- Constant Froude Number:
```bash
python RUN_FEGLA_Fr_constant.py --params params_inputs_Arica.json
```
- Squared Froude Number:
```bash
python RUN_FEGLA_Fr_squared.py --params params_inputs_Arica.json
```
- Linear Froude Number:
```bash
python RUN_FEGLA_Fr_linear.py --params params_inputs_Arica.json
```

4.	**Results Storage**
	•	All outputs are saved in the directory specified in outpath within the JSON file.
	•	The results are stored as .pkl files for further analysis.

## **Step 5: Evaluating the Best-Fit Model**
After executing all simulations, the next step is to identify the **best-fit FEGLA model** by comparing its results against the **Shallow Water Equations (SWE) simulations**, which serve as a benchmark.

```bash
# Ensure you are in the `Run/` directory::
# Run the results evaluation script
python RUN_FEGLA_Results.py --city "Arica"
```
 
## Authors

* **Francisco Sáez R.** - Assistant Researcher, CIGIDEN - [fj23eslaonda](https://github.com/fj23eslaonda)

## Acknowledgments

* [CIGIDEN](https://www.cigiden.cl/en/home/)

